@page "/unit/create"
@page "/unit/edit/{UnitCode}"
@using DevShop.Data
@inject IUnitOfWork uow
@inject NavigationManager nav
@attribute [Authorize(Roles = "7")]
@layout ManagementLayout



<h1>Units</h1>
@if (dropDownUnits != null)
{
    <select @onchange="@((e) => ChangeUnit(e))">
        <option value="0">Please select a Unit</option>
        @foreach (var _unit in dropDownUnits)
        {
            @if (isEdit && !unitChanged && _unit.Value == UnitCode)
            {
                <option value="@_unit.Value" selected>@_unit.Value - @_unit.DisplayName</option>
            }
            else
            {
                <option value="@_unit.Value">@_unit.Value - @_unit.DisplayName</option>
            }
        }
    </select>
    <br /><br />
    <EditForm Model="unit" OnValidSubmit="Save" OnInvalidSubmit="Error">
        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <b>@errorMessage</b>
            <br /><br />
        }

        @if (isEdit)
        {
            <div>
                @unit.UnitCode
            </div>
        }
        else
        {
            <input type="text" maxlength="3" placeholder="Unit-Code" pattern="[A-Z]{3}" @bind="unit.UnitCode" required><br />
        }

        <input type="text" maxlength="50" placeholder="Unit-Name" @bind="unit.UnitName" required>
        <br><br>
        <input type="submit" value="Save">
        @if (isEdit)
        {
            <input type="button" value="Delete" @onclick="@(() => Delete())" />
        }
        <br><br>
        <a href="./unit/create">
            Create a new Unit
        </a>
    </EditForm>
}
else
{
    <span>
        Loading ...
    </span>
}